---
- name: clone mytodo-sinatra repo
  git: repo=https://github.com/arvelt/my-todo-list-with-ruby-sinatra.git dest=/var/www/mytodolist-sinatra force=yes
  register: mytodolist_sinatra_root_dir

- name: put recovery data from localhost
  copy: src=~/Dropbox/backup/redmine/db/production.sqlite3 dest=/var/www/mytodolist-sinatra/db/production.sqlite3 owner=apache group=apache mode=0644

- name: who am I
  sudo: no
  command: whoami
  register: current_user

- name: change owner mytodo-sinatra dir
  file: 'path=/var/www/mytodolist-sinatra state=directory owner={{current_user.stdout}} group={{current_user.stdout}} recurse=yes'

- name: install mytodo-sinatra dependence
  sudo: no
  command: bundle install chdir=/var/www/mytodolist-sinatra

- name: chown mytodo-sinatra directory
  file: path=/var/www/mytodolist-sinatra state=directory owner=apache group=apache recurse=yes

- name: install mytodo-sinatra.conf to httpd
  template: src=mytodo-sinatra.j2 dest=/etc/httpd/conf.d/mytodolist-sinatra.conf

- name: make symbolic link to use subdirectory
  command: ln -sf /var/www/mytodolist-sinatra/public /var/www/html/todolist-simple-sinatra
  notify:
    - restart httpd
